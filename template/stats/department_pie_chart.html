{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center">統計情報</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6">
        <!-- 部署（Department）別 社員数 -->
        <div class="bg-white rounded-lg shadow-md p-4 md:p-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">部署（Department）別 社員数</h2>
            <div class="chart-container" style="position: relative; height:300px; width:100%">
                <canvas id="deptPieChart"></canvas>
            </div>
        </div>

        <!-- 所属DTE別 社員数 -->
        <div class="bg-white rounded-lg shadow-md p-4 md:p-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">所属DTE別 社員数</h2>
            <div class="chart-container" style="position: relative; height:300px; width:100%">
                <canvas id="dtePieChart"></canvas>
            </div>
        </div>

        <!-- 新卒/中途 採用者数 -->
        <div class="bg-white rounded-lg shadow-md p-4 md:p-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">新卒/中途 採用者数</h2>
            <div class="chart-container" style="position: relative; height:300px; width:100%">
                <canvas id="recruitBarChart"></canvas>
            </div>
        </div>

        <!-- 部署別 新卒・中途採用者数 -->
        <div class="bg-white rounded-lg shadow-md p-4 md:p-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">部署別 新卒・中途採用者数</h2>
            <div class="chart-container" style="position: relative; height:300px; width:100%">
                <canvas id="stackedBarChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Chart.jsのグローバル設定
    Chart.defaults.font.family = "'Noto Sans JP', 'Inter', sans-serif";
    Chart.defaults.color = '#4B5563'; // gray-700

    const commonOptions = {
        responsive: true,
        maintainAspectRatio: false, // 親要素のサイズに合わせて調整
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 20,
                    font: {
                        size: 12
                    }
                }
            },
            tooltip: {
                backgroundColor: 'rgba(0,0,0,0.7)',
                titleFont: {
                    size: 14,
                    weight: 'bold'
                },
                bodyFont: {
                    size: 12
                },
                padding: 10,
                cornerRadius: 4
            }
        }
    };

    // 部署（Department）別 社員数
    const deptPieCtx = document.getElementById('deptPieChart').getContext('2d');
    new Chart(deptPieCtx, {
        type: 'pie',
        data: {
            labels: {{ labels| safe }},
            datasets: [{
                label: '社員数',
                data: {{ data| safe }},
                backgroundColor: [
                    '#EC4899', // primary-500
                    '#3B82F6', // blue-500
                    '#F59E0B', // amber-500
                    '#10B981', // emerald-500
                    '#8B5CF6', // violet-500
                    '#EF4444', // red-500
                    '#06B6D4', // cyan-500
                    '#6B7280'  // gray-500
                ],
                borderColor: '#ffffff',
                borderWidth: 2
            }]
        },
        options: commonOptions
    });

    // 所属DTE別 社員数
    const dtePieCtx = document.getElementById('dtePieChart').getContext('2d');
    new Chart(dtePieCtx, {
        type: 'pie',
        data: {
            labels: {{ dte_labels| safe }},
            datasets: [{
                label: '社員数',
                data: {{ dte_data| safe }},
                backgroundColor: [
                    '#F59E0B', // amber-500
                    '#8B5CF6', // violet-500
                    '#10B981', // emerald-500
                    '#EC4899', // primary-500
                    '#3B82F6', // blue-500
                    '#EF4444', // red-500
                    '#06B6D4', // cyan-500
                    '#6B7280'  // gray-500
                ],
                borderColor: '#ffffff',
                borderWidth: 2
            }]
        },
        options: commonOptions
    });

    // 新卒/中途 採用者数
    const recruitBarCtx = document.getElementById('recruitBarChart').getContext('2d');
    new Chart(recruitBarCtx, {
        type: 'bar',
        data: {
            labels: {{ bar_labels| safe }},
            datasets: [{
                label: '人数',
                data: {{ bar_data| safe }},
                backgroundColor: ['#10B981', '#EC4899'], // emerald-500, primary-500
                borderColor: '#ffffff',
                borderWidth: 1
            }]
        },
        options: {
            ...commonOptions,
            plugins: {
                ...commonOptions.plugins,
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks:{
                        stepSize:1
                    },
                    grid: {
                        color: '#E5E7EB' // gray-200
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });

    // 部署別 新卒・中途採用者数 (積み上げ棒グラフ)
    const stackedBarCtx = document.getElementById('stackedBarChart').getContext('2d');
    new Chart(stackedBarCtx, {
        type: 'bar',
        data: {
            labels: {{ stacked_bar_labels| safe }},
            datasets: [
                {
                    label: '新卒',
                    data: {{ stacked_bar_new_graduate_data| safe }},
                    backgroundColor: '#3B82F6', // blue-500
                    borderColor: '#ffffff',
                    borderWidth: 1
                },
                {
                    label: '中途',
                    data: {{ stacked_bar_mid_career_data| safe }},
                    backgroundColor: '#EC4899', // primary-500
                    borderColor: '#ffffff',
                    borderWidth: 1
                }
            ]
        },
        options: {
            ...commonOptions,
            scales: {
                x: {
                    stacked: true,
                    grid: {
                        display: false
                    }
                },
                y: {
                    stacked: true,
                    beginAtZero: true,
                    ticks:{
                        stepSize:1
                    },
                    grid: {
                        color: '#E5E7EB' // gray-200
                    }
                }
            }
        }
    });
</script>
{% endblock %}